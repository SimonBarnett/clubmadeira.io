+ [templates]
+----admin.html
+----base.inc
+----community.html
+----login.html
+----merchant.html
+----overlay.inc
+----partner.html
+----roles.inc
+----signup.html
+----siterequest.inc
+----welcome.inc

admin.html
{% extends "base.inc" %}
{% block content %}
<div class="layout-wrapper">
    <!-- Menu Container (dynamically populated by site-navigation.js) -->
    <div id="menu" class="menu"></div>

    <!-- Content Wrapper -->
    <div class="content">
        <!-- Default Section (used by all roles) -->
        <div id="info" class="section" style="display: none;">
            <h2>Info</h2>
            <p>Hello, <span id="user-contact-name">[USER!]</span>! This dashboard is your central hub for overseeing the clubmadeira.io platform.</p>
            <p>Use the menu to manage affiliate programs, deal listings, user permissions, and test scripts. This powerful toolset allows you to maintain and optimize the platform for all users.</p>
        </div>

        <!-- Admin Role Sections -->
        <div id="userManagementIntro" class="section" style="display: none;">
            <h2>User Management</h2>
            <p>This section allows you to manage different types of users in your system.</p>
            <p>Select a user type from the menu to view their details or modify their permissions:</p>
            <ul>
                <li><strong>Admin:</strong> Manage users with Admin permissions.</li>
                <li><strong>Partners:</strong> Manage users with WixPro permissions.</li>
                <li><strong>Communities:</strong> Manage community users.</li>
                <li><strong>Merchants:</strong> Manage merchant users.</li>
            </ul>
        </div>

        <div id="user_management" class="section" style="display: none;">
            <h2><span id="user_role_icon" class="menu-size"></span> <span id="user_role_title"></span></h2>
            <table>
                <thead>
                    <tr>
                        <th>USERid</th>
                        <th>Contact Name</th>
                        <th>Website URL</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Permissions</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="user_list"></tbody>
            </table>
        </div>

        <div id="user_management_admin" class="section" style="display: none;">
            <h2>Admin</h2>
            <p>Admin user management.</p>
        </div>

        <div id="user_management_partners" class="section" style="display: none;">
            <h2>Partners</h2>
            <p>Partner user management.</p>
        </div>

        <div id="user_management_communities" class="section" style="display: none;">
            <h2>Communities</h2>
            <p>Community user management.</p>
        </div>

        <div id="user_management_merchants" class="section" style="display: none;">
            <h2>Merchants</h2>
            <p>Merchant user management.</p>
        </div>

        <div id="testScriptsIntro" class="section" style="display: none;">
            <h2>Test Scripts</h2>
            <p>Use this section to test referral tracking and other scripts.</p>
            <p>Select an option from the menu to visit endpoints or run referral tests under "Referral Tests."</p>
        </div>

        <div id="referralTestsIntro" class="section" style="display: none;">
            <h2>Referral Tests</h2>
            <p>This section contains tools to test referral tracking functionality.</p>
            <p>Choose "Page Visit Referral Test" or "Order Referral Test" to submit test data and verify tracking behavior.</p>
        </div>

        <div id="page_visit_test" class="section" style="display: none;">
            <h2>Page Visit Referral Test</h2>
            <div class="form">
                <form id="pageVisitForm">
                    <table>
                        <tr>
                            <td><label for="pageReferer">Referer:</label></td>
                            <td><select id="pageReferer" name="referer"></select></td>
                        </tr>
                        <tr>
                            <td><label for="page">Page:</label></td>
                            <td><input type="text" id="page" name="page" value="/home"></td>
                        </tr>
                        <tr>
                            <td><label for="pageTimestamp">Timestamp:</label></td>
                            <td><input type="text" id="pageTimestamp" name="timestamp"></td>
                        </tr>
                        <tr>
                            <td colspan="2"><button type="submit">Submit Page Visit</button></td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="order_test" class="section" style="display: none;">
            <h2>Order Referral Test</h2>
            <div class="form">
                <form id="orderForm">
                    <table>
                        <tr>
                            <td><label for="orderReferer">Referer:</label></td>
                            <td><select id="orderReferer" name="referer"></select></td>
                        </tr>
                        <tr>
                            <td><label for="orderId">Order ID:</label></td>
                            <td><input type="text" id="orderId" name="orderId" value="ORD12345"></td>
                        </tr>
                        <tr>
                            <td><label for="buyer">Buyer Name:</label></td>
                            <td><input type="text" id="buyer" name="buyer" value="John Doe"></td>
                        </tr>
                        <tr>
                            <td><label for="total">Total Amount (Â£):</label></td>
                            <td><input type="number" id="total" name="total" value="99.99" step="0.01"></td>
                        </tr>
                        <tr>
                            <td><label for="orderTimestamp">Timestamp:</label></td>
                            <td><input type="text" id="orderTimestamp" name="timestamp"></td>
                        </tr>
                        <tr>
                            <td colspan="2"><button type="submit">Submit Order</button></td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="test_partner" class="section" style="display: none;">
            <h2>Test Partner</h2>
            <p>Test partner-related functionality here.</p>
        </div>

        <div id="test_merchant" class="section" style="display: none;">
            <h2>Test Merchant</h2>
            <p>Test merchant-related functionality here.</p>
        </div>

        <div id="test_community" class="section" style="display: none;">
            <h2>Test Community</h2>
            <p>Test community-related functionality here.</p>
        </div>

        <!-- Merchant Role Sections -->
        <div id="deal_listings" class="section" style="display: none;">
            <h2>Discounted Deal Listings</h2>
            <p>This section displays all currently active deal listings available across your affiliate programs.</p>
            <div style="display: flex; gap: 20px;">
                <div style="flex: 1; max-width: 300px;">
                    <h3>Categories</h3>
                    <div class="treeview" id="categoryTree"></div>
                </div>
                <div style="flex: 2;">
                    <table class="deals-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Title</th>
                                <th>URL</th>
                                <th>Price</th>
                                <th>Original</th>
                                <th>Discount %</th>
                                <th>Image</th>
                                <th>QTY</th>
                            </tr>
                        </thead>
                        <tbody id="dealList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Community Role Sections -->
        <div id="posts" class="section" style="display: none;">
            <h2>Posts</h2>
            <p>Manage community posts here.</p>
        </div>

        <!-- Partner Role Sections -->
        <div id="referrals" class="section" style="display: none;">
            <h2>Referrals</h2>
            <p>Manage referrals here.</p>
        </div>

        <!-- Shared Sections Across All Roles -->
        <div id="affiliates" class="section" style="display: none;">
            <h2>Affiliate Programs</h2>
            <p>Use this section to manage your affiliate program credentials.</p>
            <div id="affiliate-icons" style="display: flex; gap: 20px; margin-bottom: 20px;"></div>
            <form id="affiliate-form" style="display: none;">
                <div id="affiliate-fields">
                    <i class="selected-setting-icon" style="font-size: 16px; color: currentColor; margin-right: 10px; vertical-align: middle;"></i>
                    <h3 class="affiliate-comment-heading" style="display: inline-block; vertical-align: middle;"></h3>
                    <a href="#" class="affiliate-api-link" style="margin-left: 10px; display: none; vertical-align: middle; color: currentColor;"><i class="fas fa-link" style="font-size: 16px;"></i></a>
                    <a href="#" class="affiliate-signup-link" style="margin-left: 10px; display: none; vertical-align: middle; color: currentColor;"><i class="fas fa-user-plus" style="font-size: 16px;"></i></a>
                    <a href="#" class="affiliate-readme-link" style="margin-left: 10px; display: none; vertical-align: middle; color: currentColor;"><i class="fas fa-book" style="font-size: 16px;"></i></a>
                    <a href="#" class="affiliate-keys-link" style="margin-left: 10px; display: none; vertical-align: middle; color: currentColor;"><i class="fas fa-key" style="font-size: 16px;"></i></a>
                    <p class="affiliate-description" style="margin-bottom: 15px;"></p>
                    <div id="affiliate-readme-content" style="display: none;"></div>
                </div>
                <button type="submit" class="btn" style="margin-top: 10px; color: currentColor; padding: 5px 10px;"><i class="fas fa-save" style="margin-right: 5px;"></i>Save Settings</button>
            </form>
        </div>

        <div id="site_settings" class="section" style="display: none;">
            <h2>Site Settings</h2>
            <p>Use this section to manage site-wide settings and API credentials.</p>
            <div id="site-settings-icons" style="display: flex; gap: 20px; margin-bottom: 20px;"></div>
            <form id="site-settings-form" style="display: none;">
                <div id="site-settings-fields">
                    <i class="selected-setting-icon" style="font-size: 16px; color: currentColor; margin-right: 10px; vertical-align: middle;"></i>
                    <h3 class="site-settings-comment-heading" style="display: inline-block; vertical-align: middle;"></h3>
                    <a href="#" class="site-settings-api-link" style="margin-left: 10px; display: none; vertical-align: middle; color: currentColor;"><i class="fas fa-link" style="font-size: 16px;"></i></a>
                    <p class="site-settings-description" style="margin-bottom: 15px;"></p>
                </div>
                <button type="submit" class="btn" style="margin-top: 10px; color: currentColor; padding: 5px 10px;"><i class="fas fa-save" style="margin-right: 5px;"></i>Save Settings</button>
            </form>
        </div>

        <div id="settings" class="section" style="display: none;">
            <h2>Settings</h2>
            <p>Configure settings specific to your role here.</p>
        </div>

        <div id="categories" class="section" style="display: none;">
            <h2>Categories</h2>
            <p>Manage categories here.</p>
        </div>

        <!-- My Account Sections (shared across all roles) -->
        <div id="my-account" class="section" style="display: none;">
            <h2>My Account</h2>
        </div>

        <div id="contact-details" class="section" style="display: none;">
            <h2>Contact Details</h2>
            <div class="form-group">
                <label for="contactName">Name:</label>
                <input type="text" id="contactName" name="contact_name" readonly>
            </div>
            <div class="form-group">
                <label for="emailAddress">Email:</label>
                <input type="email" id="emailAddress" name="email_address" readonly>
            </div>
            <div class="form-group">
                <label for="phoneNumber">Phone Number:</label>
                <input type="tel" id="phoneNumber" name="phone_number" readonly>
            </div>
        </div>

        <div id="change-password" class="section" style="display: none;">
            <h2>Change Password</h2>
            <form id="myAccountForm">
                <div class="form-group">
                    <label for="currentPassword">Current Password:</label>
                    <input type="password" id="currentPassword" name="current_password">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password:</label>
                    <input type="password" id="newPassword" name="new_password">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password:</label>
                    <input type="password" id="confirmPassword" name="confirm_password">
                </div>
                <button type="submit">Update Password</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
base.inc
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title | default('clubmadeira.io') }}</title>
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <!-- Local CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/icons.css?v=1.0.1') }}">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><path fill='black' d='M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160zM201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z'/></svg>" type="image/svg+xml">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    <!-- Dynamic API URL -->
    <script>
        window.apiUrl = 'https://clubmadeira.io';
    </script>
    <!-- External JS -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" defer></script>
    <script src="https://cdn.tiny.cloud/1/YOUR_VALID_API_KEY/tinymce/6/tinymce.min.js" defer></script>
</head>
<body {% block body_attributes %}{% endblock %}>
    <!-- Hidden input for userId -->
    <input type="text" id="userId" style="display: none;" value="{{ user.user_id if user and user.user_id is defined else '' }}">

    <!-- Debug script to log template variables -->
    <script>
        const xRole = {{ x_role | tojson if x_role is defined else '"undefined"' }};
        const pageType = {{ page_type | tojson if page_type is defined else '"undefined"' }};
        const user = {{ user | tojson if user is defined else '"undefined"' }};

        console.log('base.inc - Template variables - x_role:', xRole);
        console.log('base.inc - Template variables - page_type:', pageType);
        console.log('base.inc - Template variables - user:', user);
    </script>

    <div class="layout-wrapper">
        <div class="header">
            {% include 'roles.inc' %}            
        </div>        
        {% include 'overlay.inc' %}
        <div class="content">
            <!-- Menu Container (dynamically populated by navigation.js) -->
            <div id="menu" class="menu"></div>
            <!-- Info Section (includes welcome.inc) -->
            <div id="info" class="section" style="display: none;">
                {% include 'welcome.inc' with context %}
            </div>
            <!-- Role-specific sections (corresponding to navigation menu buttons) -->
            {% block content %}{% endblock %}
            <!-- My Account Sections (shared across all roles) -->
            <div id="my-account" class="section" style="display: none;">
                <h2>My Account</h2>
            </div>
            <div id="contact-details" class="section" style="display: none;">
                <h2>Contact Details</h2>
                <div class="form-group">
                    <label for="contactName">Name:</label>
                    <input type="text" id="contactName" name="contact_name" readonly>
                </div>
                <div class="form-group">
                    <label for="emailAddress">Email:</label>
                    <input type="email" id="emailAddress" name="email_address" readonly>
                </div>
                <div class="form-group">
                    <label for="phoneNumber">Phone Number:</label>
                    <input type="tel" id="phoneNumber" name="phone_number" readonly>
                </div>
            </div>
            <div id="change-password" class="section" style="display: none;">
                <h2>Change Password</h2>
                <form id="myAccountForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password:</label>
                        <input type="password" id="currentPassword" name="current_password">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password:</label>
                        <input type="password" id="newPassword" name="new_password">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password:</label>
                        <input type="password" id="confirmPassword" name="confirm_password">
                    </div>
                    <button type="submit">Update Password</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Core script using new consolidated structure -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- Page-specific scripts -->
    {% if page_type == 'login' %}
        <script type="module" src="{{ url_for('static', filename='js/login-page.js') }}" defer></script>
    {% elif page_type == 'admin' %}
        <script type="module" src="{{ url_for('static', filename='js/admin-page.js') }}" defer></script>
    {% elif page_type == 'merchant' %}
        <script type="module" src="{{ url_for('static', filename='js/category-management.js') }}" defer></script>
        <script type="module" src="{{ url_for('static', filename='js/site-request.js') }}" defer></script>
        <script type="module" src="{{ url_for('static', filename='js/merchant-page.js') }}" defer></script>
    {% elif page_type == 'partner' %}
        <script type="module" src="{{ url_for('static', filename='js/partner-page.js') }}" defer></script>
    {% elif page_type == 'community' %}
        <script type="module" src="{{ url_for('static', filename='js/category-management.js') }}" defer></script>
        <script type="module" src="{{ url_for('static', filename='js/site-request.js') }}" defer></script>
        <script type="module" src="{{ url_for('static', filename='js/community-page.js') }}" defer></script>
    {% endif %}

    <script>
        // Minimal DOMContentLoaded handler for markdown links only
        document.addEventListener('DOMContentLoaded', function() {
            const layoutWrapper = document.querySelector('.layout-wrapper');
            layoutWrapper.style.display = 'none'; // Hide initially until initialized by pageSetup.js

            // Add event listeners for markdown rendering
            if (typeof marked !== 'undefined' && typeof marked.parse === 'function') {
                document.querySelectorAll('.md-link').forEach(link => {
                    link.addEventListener('click', function(event) {
                        event.preventDefault();
                        const mdPath = this.getAttribute('data-md-path');
                        const targetId = 'md-render-target';
                        const target = document.getElementById(targetId);
                        if (target) {
                            fetch(mdPath)
                                .then(response => response.text())
                                .then(text => {
                                    target.innerHTML = marked.parse(text);
                                })
                                .catch(err => console.error('Failed to render markdown:', err));
                        }
                    });
                });
            } else {
                console.error('marked.parse is not defined');
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
community.html
{% extends "base.inc" %}
{% block body_attributes %}data-page-type="community"{% endblock %}
{% block content %}
    <div class="layout-wrapper">
        <!-- Menu Container (dynamically populated by site-navigation.js) -->
        <div id="menu" class="menu"></div>

        <!-- Content Wrapper -->
        <div class="content">
            <div id="welcome" class="section active">
                <h2>Welcome to Your Community Dashboard</h2>
                <p>Welcome! This dashboard is your hub for managing your community account and tracking referrals.</p>
                <p>Use the menu on the left to:</p>
                <ul>
                    <li>Learn how to add discounts to your website or request a site under "My Web Site"</li>
                    <li>Select product categories for your site in "My Categories"</li>
                    <li>View referral statistics under "My Referrals"</li>
                    <li>Update your account details in "My Account"</li>
                </ul>
            </div>                
            <div id="categories" class="section" style="display: none;">
                <h2>My Categories</h2>
                <p>This section lets you choose which product categories will appear on your website's "Community Discounts" page.</p>
                <div class="treeview" id="categoryTree"></div>
            </div>
            <div id="referrals_intro" class="section" style="display: none;">
                <h2>My Referrals</h2>
                <p>This section allows you to track your referral activity.</p>
                <p>Select from the submenu options:</p>
                <ul>
                    <li><strong>Visits:</strong> View pages visited through your referral links.</li>
                    <li><strong>Orders:</strong> See orders placed via your referrals.</li>
                </ul>
            </div>
            <div id="visits" class="section" style="display: none;">
                <h2>Visits</h2>
                <div class="toggle-section" data-toggle="visits_this_month"><i class="fas fa-calendar-day"></i> This Month</div>
                <div id="visits_this_month" class="toggle-content open">
                    <table id="visitsTableThisMonth">
                        <thead><tr><th>Page</th><th>Timestamp</th></tr></thead>
                        <tbody id="visitsListThisMonth"></tbody>
                    </table>
                </div>
                <div class="toggle-section" data-toggle="visits_last_month"><i class="fas fa-calendar-alt"></i> Last Month</div>
                <div id="visits_last_month" class="toggle-content">
                    <table id="visitsTableLastMonth">
                        <thead><tr><th>Page</th><th>Timestamp</th></tr></thead>
                        <tbody id="visitsListLastMonth"></tbody>
                    </table>
                </div>
                <div class="toggle-section" data-toggle="visits_earlier"><i class="fas fa-history"></i> Earlier</div>
                <div id="visits_earlier" class="toggle-content">
                    <table id="visitsTableEarlier">
                        <thead><tr><th>Page</th><th>Timestamp</th></tr></thead>
                        <tbody id="visitsListEarlier"></tbody>
                    </table>
                </div>
            </div>
            <div id="orders" class="section" style="display: none;">
                <h2>Orders</h2>
                <div class="toggle-section" data-toggle="orders_this_month"><i class="fas fa-calendar-day"></i> This Month</div>
                <div id="orders_this_month" class="toggle-content open">
                    <table id="ordersTableThisMonth">
                        <thead><tr><th>Order ID</th><th>Buyer</th><th>Total</th><th>Timestamp</th></tr></thead>
                        <tbody id="ordersListThisMonth"></tbody>
                    </table>
                </div>
                <div class="toggle-section" data-toggle="orders_last_month"><i class="fas fa-calendar-alt"></i> Last Month</div>
                <div id="orders_last_month" class="toggle-content">
                    <table id="ordersTableLastMonth">
                        <thead><tr><th>Order ID</th><th>Buyer</th><th>Total</th><th>Timestamp</th></tr></thead>
                        <tbody id="ordersListLastMonth"></tbody>
                    </table>
                </div>
                <div class="toggle-section" data-toggle="orders_earlier"><i class="fas fa-history"></i> Earlier</div>
                <div id="orders_earlier" class="toggle-content">
                    <table id="ordersTableEarlier">
                        <thead><tr><th>Order ID</th><th>Buyer</th><th>Total</th><th>Timestamp</th></tr></thead>
                        <tbody id="ordersListEarlier"></tbody>
                    </table>
                </div>
            </div>
            <div id="my_website_intro_section" class="section" style="display: none;">
                <h2>My Web Site</h2>
                <p>Welcome to the "My Web Site" section! Here, you can learn how to integrate discounts into your community website.</p>
                <p>Choose your website provider from the menu to get started, or select "I Donât Have a Website Yet" to request a new site setup.</p>
                <div id="website-provider-icons" style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <i class="fab fa-wix-simple" data-section="wix" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                    <i class="fab fa-wordpress" data-section="wordpress" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                    <i class="fab fa-squarespace" data-section="squarespace" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                    <i class="fab fa-weebly" data-section="weebly" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                    <i class="fab fa-joomla" data-section="joomla" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                    <i class="fas fa-question-circle" data-section="no_website" style="cursor: pointer; width: 48px; height: 48px; font-size: 48px; color: #C0C0C0;"></i>
                </div>
                <div id="client-api-settings"></div>
            </div>
            <div id="wix" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="height: 32px; width: auto; margin-right: 10px;">
                        <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                        <path d="M393.4 131.7c0 13 2.1 32.7-28.7 43.8-9.5 3.5-16 9.7-16 9.7 0-31 4.7-42.2 17.4-48.9 9.8-5.1 27.2-4.6 27.2-4.6zm-115.8 35.5l-34.2 132.7-28.5-108.6c-7.7-32-20.8-48.5-48.4-48.5-27.4 0-40.7 16.2-48.4 48.5L89.5 299.9 55.3 167.2C49.7 140.5 23.9 129 0 132l65.6 247.9s21.6 1.6 32.5-4c14.2-7.3 21-12.8 29.6-46.6 7.7-30.1 29.1-118.4 31.1-124.7 4.8-14.9 11.1-13.8 15.4 0 2 6.3 23.5 94.6 31.1 124.7 8.6 33.7 15.4 39.3 29.6 46.6 10.8 5.5 32.5 4 32.5 4l65.6-247.9c-24.4-3.1-49.8 8.9-55.3 35.3zm115.8 5.2s-4.1 6.3-13.5 11.6c-6 3.4-11.8 5.6-18 8.6-15.1 7.3-13.2 14-13.2 35.2v152.1s16.6 2.1 27.4-3.4c13.9-7.1 17.1-14 17.3-44.8V181.4l0 0v-9zm163.4 84.1L640 132.8s-35.1-6-52.5 9.9c-13.3 12.1-24.4 29.6-54.2 72.5-.5 .7-6.3 10.5-13.1 0-29.3-42.2-40.8-60.3-54.2-72.5-17.4-15.8-52.5-9.9-52.5-9.9l83.2 123.7-83 123.4s36.6 4.6 54-11.2c11.5-10.5 17.6-20.4 52.5-70.7 6.8-10.5 12.6-.8 13.1 0 29.4 42.4 39.2 58.1 53.1 70.7 17.4 15.8 53.3 11.2 53.3 11.2L556.8 256.5z"/>
                    </svg>
                    <h2>Wix Integration</h2>
                </div>
                <p>Add discounts to your Wix site:</p>
                <ol>
                    <li>Log in to Wix and open the Editor.</li>
                    <li>Click "+" > "Embed" > "Embed a Widget".</li>
                    <li>Paste: <code id="wixCode"><iframe src="https://clubmadeira.io/discounts?referrer=[YourUserID]" width="100%" height="600"></iframe></code></li>
                    <li>Publish.</li>
                </ol>
            </div>
            <div id="wordpress" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fab fa-wordpress" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>WordPress Integration</h2>
                </div>
                <p>Add discounts to WordPress:</p>
                <ol>
                    <li>Log in to WordPress admin.</li>
                    <li>Go to "Pages" > "Add New".</li>
                    <li>Add "Custom HTML" block: <code id="wordpressCode"><iframe src="https://clubmadeira.io/discounts?referrer=[YourUserID]" width="100%" height="600"></iframe></code></li>
                    <li>Publish.</li>
                </ol>
            </div>
            <div id="squarespace" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fab fa-squarespace" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>Squarespace Integration</h2>
                </div>
                <p>Integrate discounts into Squarespace:</p>
                <ol>
                    <li>Log in to Squarespace editor.</li>
                    <li>Add a new page.</li>
                    <li>Add "Code" block: <code id="squarespaceCode"><iframe src="https://clubmadeira.io/discounts?referrer=[YourUserID]" width="100%" height="600"></iframe></code></li>
                    <li>Update site.</li>
                </ol>
            </div>
            <div id="weebly" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fab fa-weebly" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>Weebly Integration</h2>
                </div>
                <p>Add discounts to Weebly:</p>
                <ol>
                    <li>Log in to Weebly editor.</li>
                    <li>Drag "Embed Code" onto page.</li>
                    <li>Paste: <code id="weeblyCode"><iframe src="https://clubmadeira.io/discounts?referrer=[YourUserID]" width="100%" height="600"></iframe></code></li>
                    <li>Publish.</li>
                </ol>
            </div>
            <div id="joomla" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fab fa-joomla" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>Joomla Integration</h2>
                </div>
                <p>Integrate discounts into Joomla:</p>
                <ol>
                    <li>Log in to Joomla admin.</li>
                    <li>Go to "Content" > "Articles" > "Add New".</li>
                    <li>Paste in "Code" view: <code id="joomlaCode"><iframe src="https://clubmadeira.io/discounts?referrer=[YourUserID]" width="100%" height="600"></iframe></code></li>
                    <li>Save.</li>
                </ol>
            </div>
            <div id="no_website" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fas fa-question-circle" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>I Donât Have a Website Yet</h2>
                </div>
                <p>Request a custom Wix website for your community from our Wix Professionals. Fill out the form below to specify your needs:</p>
                {% with user_type='community' %}
                    {% include 'siterequest.inc' %}
                {% endwith %}
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <!-- TinyMCE initialization for siterequest.inc -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            tinymce.init({
                selector: '#aboutCommunity, #stylingDetails, #page1Content',
                inline: true,
                menubar: false,
                toolbar: 'bold italic | bullist numlist | link',
                plugins: 'lists link',
                setup: (editor) => {
                    editor.on('init', () => {
                        console.log('TinyMCE initialized for:', editor.id);
                    });
                }
            });
        });
    </script>
{% endblock %}
login.html
{% extends "base.inc" %}
{% block body_attributes %}data-page-type="login"{% endblock %}
{% block content %}
<!-- Deployed 2025-03-31 v11, Updated 2025-04-09 -->
<div class="login-page">
    <div id="loadingOverlay" class="hidden">
        <div class="multicircle-loader">
            <div class="circle circle1"></div>
            <div class="circle circle2"></div>
            <div class="circle circle3"></div>
            <div class="circle circle4"></div>
        </div>
    </div>
    
    <div class="container" id="loginContainer">
        <form id="loginForm" class="form" method="POST" action="/">
            <div class="form-group">
                <label for="loginEmail">Email:</label>
                <div class="input-container">
                    <input type="email" id="loginEmail" name="email" placeholder="Enter your email" required>
                </div>
            </div>
            <div class="form-group">
                <label for="loginPassword">Password:</label>
                <div class="input-container">
                    <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required>
                    <span class="toggle-password"><i class="fas fa-eye"></i></span>
                </div>
            </div>
            <button type="submit">Login</button>
        </form>
        <div class="toggle-link">
            <a href="{{ url_for('authentication_bp.signup') }}">Need an account? Sign Up</a><br>
            <a href="#" onclick="showForgotPassword(); return false;">Forgot Password?</a>
        </div>
    </div>

    <div class="container hidden" id="forgotPasswordContainer">
        <h2>Forgot Password</h2>
        <form id="forgotPasswordForm" class="form" method="POST" action="/reset-password">
            <div class="form-group">
                <label for="forgotEmail">Email:</label>
                <input type="email" id="forgotEmail" name="email" placeholder="Enter your email" required>
            </div>
            <button type="submit">Send OTP via SMS</button>
        </form>
        <div class="toggle-link">
            <a href="#" onclick="showLogin(); return false;">Back to Login</a>
        </div>
    </div>

    <div class="container hidden" id="verifyOtpContainer">
        <h2>Verify OTP</h2>
        <form id="verifyOtpForm" class="form" method="POST" action="/verify-reset-code">
            <div class="form-group">
                <label for="verifyEmail">Email:</label>
                <input type="email" id="verifyEmail" name="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="otpCode">One-Time Password:</label>
                <input type="text" id="otpCode" name="code" placeholder="Enter the OTP from SMS" required>
            </div>
            <div class="form-group">
                <label for="newPassword">New Password:</label>
                <input type="password" id="newPassword" name="new_password" placeholder="Enter new password" required>
            </div>
            <div class="form-group">
                <label for="confirmNewPassword">Confirm New Password:</label>
                <input type="password" id="confirmNewPassword" name="confirm_new_password" placeholder="Confirm new password" required>
            </div>
            <button type="submit">Update Password</button>
        </form>
        <div class="toggle-link">
            <a href="#" onclick="showLogin(); return false;">Back to Login</a>
        </div>
    </div>
</div>
{% endblock %}
merchant.html
{% extends 'base.inc' %}
{% block body_attributes %}data-page-type="merchant"{% endblock %}
{% block content %}
    <div class="layout-wrapper">
        <!-- Menu Container (dynamically populated by site-navigation.js) -->
        <div id="menu" class="menu"></div>

        <!-- Content Wrapper -->
        <div class="content">
            <div id="store-request" class="section" style="display: none;">
                <h2>My Store Request</h2>
                <p>Manage your store request details here.</p>
            </div>
            <div id="api-keys" class="section" style="display: none;">
                <h2>API Keys</h2>
                <div id="api-keys-icons" style="display: flex; gap: 20px; margin-bottom: 20px;"></div>
                <form id="api-keys-form" style="display: none;">
                    <div id="api-keys-fields"></div>
                    <button type="submit" class="btn" style="margin-top: 10px;">Submit</button>
                </form>
            </div>
            <div id="create-store" class="section" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <i class="fas fa-store" style="font-size: 32px; margin-right: 10px;"></i>
                    <h2>Create Store</h2>
                </div>
                <p>Request a custom Wix store to sell your products online. Provide details below to set up your store (minimum: Home and Returns Policy pages).</p>
                {% with user_type='merchant' %}
                    {% include 'siterequest.inc' %}
                {% endwith %}
            </div>
            <div id="my-products" class="section" style="display: none;">
                <h2>My Products</h2>
                <p>These are the products from your parts feed.</p>
                <table id="productTable">
                    <thead>
                        <tr><th class="hidden">ID</th><th>Category</th><th>Title</th><th>URL</th><th>Price</th><th>Original</th><th>Image</th><th>QTY</th></tr>
                    </thead>
                    <tbody id="productList"></tbody>
                </table>
            </div>
            <div id="documentation-content" class="section" style="display: none;">                
                <div id="md-render-target">
                    <p>Select a documentation item from the menu to view the details.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        console.log('merchant.html - Template loaded');
    </script>
{% endblock %}
overlay.inc
<div id="loadingOverlay" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 1); justify-content: center; align-items: center; z-index: 9999;">
    <div style="position: relative; width: 200px; height: 200px;">
        <div style="position: absolute; border-radius: 50%; border: 8px solid transparent; animation: spin 1.5s linear infinite; width: 120px; height: 120px; border-top-color: #ff6f61; top: 40px; left: 40px; animation-delay: 0s;"></div>
        <div style="position: absolute; border-radius: 50%; border: 8px solid transparent; animation: spin 1.5s linear infinite; width: 90px; height: 90px; border-top-color: #6bff61; top: 55px; left: 55px; animation-delay: 0.3s;"></div>
        <div style="position: absolute; border-radius: 50%; border: 8px solid transparent; animation: spin 1.5s linear infinite; width: 60px; height: 60px; border-top-color: #61cfff; top: 70px; left: 70px; animation-delay: 0.6s;"></div>
        <div style="position: absolute; border-radius: 50%; border: 8px solid transparent; animation: spin 1.5s linear infinite; width: 30px; height: 30px; border-top-color: #ff61ff; top: 85px; left: 85px; animation-delay: 0.9s;"></div>
    </div>
</div>
<style>
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
partner.html
{% extends "base.inc" %}
{% block body_attributes %}data-page-type="partner"{% endblock %}
{% block content %}
    <div class="layout-wrapper">
        <!-- Menu Container (dynamically populated by site-navigation.js) -->
        <div id="menu" class="menu"></div>

        <!-- Content Wrapper -->
        <div class="content">
            <div id="integrations" class="section" style="display: none;">
                <h2>Integrations</h2>
                <p>View your integration statuses below.</p>
                <ul id="integrationList"></ul>
            </div>
        </div>
    </div>
    <script>
        console.log('partner.html - Template loaded');
    </script>
{% endblock %}
roles.inc
<!-- templates/roles.inc -->
{% if page_type == 'admin' %}
<button data-section="info" style="color: currentcolor; padding: 20px; border-radius: 8px; display: flex; align-items: center; gap: 25px; height: 120px; box-sizing: border-box; overflow: visible; background: none; border: none; width: 100%; text-align: left; cursor: pointer;">
    <span class="icon-admin" style="width: 50px; height: 50px;"></span>
    <div>
        <h1 style="margin: 0; font-size: 24px; color: currentcolor;">Admin Dashboard</h1>
        <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9; color: currentcolor;">Manage your platform with powerful tools and insights.</p>
    </div>
</button>
{% elif page_type == 'merchant' %}
<button data-section="info" style="color: currentcolor; padding: 20px; border-radius: 8px; display: flex; align-items: center; gap: 15px; height: 120px; box-sizing: border-box; overflow: visible; background: none; border: none; width: 100%; text-align: left; cursor: pointer;">
    <span class="icon-merchant" style="width: 50px; height: 50px;"></span>
    <div>
        <h1 style="margin: 0; font-size: 24px; color: currentcolor;">Merchant Dashboard</h1>
        <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9; color: currentcolor;">Track sales, manage deals, and grow your business.</p>
    </div>
</button>
{% elif page_type == 'community' %}
<button data-section="info" style="color: currentcolor; padding: 20px; border-radius: 8px; display: flex; align-items: center; gap: 15px; height: 120px; box-sizing: border-box; overflow: visible; background: none; border: none; width: 100%; text-align: left; cursor: pointer;">
    <span class="icon-community" style="width: 50px; height: 50px;"></span>
    <div>
        <h1 style="margin: 0; font-size: 24px; color: currentcolor;">Community Dashboard</h1>
        <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9; color: currentcolor;">Connect with members and share valuable resources.</p>
    </div>
</button>
{% elif page_type == 'partner' %}
<button data-section="info" style="color: currentcolor; padding: 20px; border-radius: 8px; display: flex; align-items: center; gap: 15px; height: 120px; box-sizing: border-box; overflow: visible; background: none; border: none; width: 100%; text-align: left; cursor: pointer;">
    <span class="icon-partner" style="width: 50px; height: 50px;"></span>
    <div>
        <h1 style="margin: 0; font-size: 24px; color: currentcolor;">Partner Dashboard</h1>
        <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9; color: currentcolor;">Collaborate and create with our partner tools.</p>
    </div>
</button>
{% else %}
<div style="color: currentcolor; padding: 20px; border-radius: 8px; display: flex; align-items: center; gap: 15px; height: 120px; box-sizing: border-box; overflow: visible;">
    <span class="icon-community" style="width: 50px; height: 50px;"></span>
    <div>
        <h1 style="margin: 0; font-size: 24px; color: currentcolor;">Welcome to clubmadeira.io</h1>
        <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9; color: currentcolor;">Log in to access your dashboard.</p>
    </div>
</div>
{% endif %}
signup.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link rel="stylesheet" href="/static/signup.css"> <!-- Link to combined styles with pulse -->
    <!-- Favicon: Font Awesome "group-arrows-rotate" SVG (Unicode f366) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><path d='M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160zM201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z'/></svg>" type="image/svg+xml">
</head>
<body>
    <div class="signup-container">
        <h1>Sign Up - I am a...</h1>
        <form id="signupForm" autocomplete="off">
            <!-- Dummy fields to trick autofill -->
            <input type="text" class="hidden" autocomplete="off">
            <input type="text" class="hidden" autocomplete="off">
            <div class="options">
                <label class="option">
                    <input type="radio" name="signup_type" value="community" checked>
                    <img src="{{ url_for('static', filename='img/community.jpg') }}" alt="Scout leader in uniform, neck down">
                    <span>Community Group</span>
                </label>
                <label class="option">
                    <input type="radio" name="signup_type" value="seller">
                    <img src="{{ url_for('static', filename='img/merchant.jpg') }}" alt="White man in business suit, neck down">
                    <span>Merchant</span>
                </label>
                <label class="option">
                    <input type="radio" name="signup_type" value="wixpro">
                    <img src="{{ url_for('static', filename='img/wixpro.jpg') }}" alt="Female ethnic web designer in casual dress, neck down">
                    <span>Partner</span>
                </label>
            </div>
            <div class="form-section">
                <div class="form-group">
                    <label for="contact_name">Contact Name:</label>
                    <div class="input-container">
                        <input type="text" id="contact_name" name="contact_name" required autocomplete="off">
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-phone">Phone Number:</label>
                    <div class="input-container">
                        <input type="tel" id="signup-phone" name="signup_phone" autocomplete="off" pattern="[0-9]{10}" title="Please enter a 10-digit phone number">
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <div class="input-container">
                        <input type="text" id="signup-email" name="signup_email" required autocomplete="off">
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password:</label>
                    <div class="input-container">
                        <input type="text" id="signup-password" name="signup_password" required autocomplete="new-password">
                        <i class="fas fa-eye toggle-password" data-target="signup-password"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password:</label>
                    <div class="input-container">
                        <input type="password" id="signup-confirm-password" name="signup_confirm_password" required autocomplete="new-password">
                        <i class="fas fa-eye toggle-password" data-target="signup-confirm-password"></i>
                    </div>
                </div>
                <button type="submit">Sign Me Up</button>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Set correct input types and clear fields after load
        window.onload = function() {
            const emailInput = document.getElementById('signup-email');
            const passwordInput = document.getElementById('signup-password');
            const confirmPasswordInput = document.getElementById('signup-confirm-password');
            const phoneInput = document.getElementById('signup-phone');

            // Set proper types
            emailInput.type = 'email';
            passwordInput.type = 'password';

            // Double-clear strategy
            setTimeout(function() {
                emailInput.value = '';
                passwordInput.value = '';
                confirmPasswordInput.value = '';
                phoneInput.value = '';
            }, 100);

            setTimeout(function() {
                emailInput.value = '';
                passwordInput.value = '';
                confirmPasswordInput.value = '';
                phoneInput.value = '';
            }, 500); // Extra delay for Chrome

            // Set "Community Group" as selected by default
            const communityOption = document.querySelector('input[value="community"]').closest('.option');
            communityOption.classList.add('selected');
        };

        // Clear fields on focus
        document.getElementById('signup-email').addEventListener('focus', function() {
            this.value = '';
        });
        document.getElementById('signup-password').addEventListener('focus', function() {
            this.value = '';
        });
        document.getElementById('signup-confirm-password').addEventListener('focus', function() {
            this.value = '';
        });
        document.getElementById('signup-phone').addEventListener('focus', function() {
            this.value = '';
        });

        // Highlight selected option
        document.querySelectorAll('input[name="signup_type"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.option').forEach(function(option) {
                    option.classList.remove('selected');
                });
                if (this.checked) {
                    this.closest('.option').classList.add('selected');
                }
            });
        });

        // Dynamically set 'required' attribute for phone number based on signup type
        document.querySelectorAll('input[name="signup_type"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                const phoneInput = document.getElementById('signup-phone');
                if (this.value === 'wixpro') {
                    phoneInput.removeAttribute('required');
                } else {
                    phoneInput.setAttribute('required', '');
                }
            });

            // Set initial phone requirement based on default selection
            const phoneInput = document.getElementById('signup-phone');
            if (radio.value === 'community' && radio.checked) {
                phoneInput.setAttribute('required', '');
            }
        });

        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(function(icon) {
            icon.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const input = document.getElementById(targetId);
                if (input.type === 'password') {
                    input.type = 'text';
                    this.classList.remove('fa-eye');
                    this.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    this.classList.remove('fa-eye-slash');
                    this.classList.add('fa-eye');
                }
            });
        });

        // Form submission with OTP workflow
        $('#signupForm').on('submit', async function(e) {
            e.preventDefault();

            const signupType = $('input[name="signup_type"]:checked').val();
            if (!signupType) {
                toastr.error('Please select a signup type.');
                return;
            }

            const contactName = $('#contact_name').val().trim();
            const phone = $('#signup-phone').val().trim();
            const email = $('#signup-email').val().trim();
            const password = $('#signup-password').val().trim();
            const confirmPassword = $('#signup-confirm-password').val().trim();

            // Validation: Check all required fields, password match, and phone validity
            if (!contactName || !email || !password || !confirmPassword) {
                toastr.error('All fields except phone (for Partner) must be filled.');
                return;
            }

            if (password !== confirmPassword) {
                toastr.error('Passwords do not match.');
                return;
            }

            const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d).{8,}$/;
            if (!passwordRegex.test(password)) {
                toastr.error('Password must be 8+ characters with letters and numbers.');
                return;
            }

            if (signupType !== 'wixpro') {
                if (!phone) {
                    toastr.error('Phone number is required for Community Group and Merchant.');
                    return;
                }
                const phoneRegex = /^\d{10}$/;
                if (!phoneRegex.test(phone)) {
                    toastr.error('Enter a valid 10-digit phone number (e.g., 1234567890).');
                    return;
                }
            }

            const signupData = { 
                signup_type: signupType, 
                contact_name: contactName, 
                signup_phone: phone || null, 
                signup_email: email, 
                signup_password: password 
            };

            try {
                // Step 1: Create user with /signup
                const signupResponse = await fetch('/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(signupData)
                });
                const signupDataResp = await signupResponse.json();
                if (!signupResponse.ok) throw new Error(signupDataResp.message || 'Signup failed');

                if (signupType === 'wixpro') {
                    // Partner: Direct to login
                    toastr.success('Signup successful! Redirecting to login...');
                    setTimeout(() => window.location.href = '/login', 2000);
                } else {
                    // Merchant/Community: Send OTP with /reset-password
                    const otpResponse = await fetch('/reset-password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    const otpData = await otpResponse.json();
                    if (!otpResponse.ok) throw new Error(otpData.message || 'Failed to send OTP');

                    toastr.success('OTP sent to your phone. Please enter it below.');
                    const otpContainer = document.createElement('div');
                    otpContainer.innerHTML = `
                        <div class="form-group">
                            <label for="signupOtp">Enter OTP:</label>
                            <input type="text" id="signupOtp" name="otp" placeholder="Enter OTP" required>
                        </div>
                        <button id="verifyOtpBtn">Verify OTP</button>
                    `;
                    this.appendChild(otpContainer);
                    this.querySelector('.form-section').style.display = 'none';

                    document.getElementById('verifyOtpBtn').addEventListener('click', async () => {
                        const otp = document.getElementById('signupOtp').value.trim();
                        if (!otp) {
                            toastr.error('Please enter the OTP.');
                            return;
                        }

                        // Step 2: Verify OTP with /verify-reset-code
                        const verifyResponse = await fetch('/verify-reset-code', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email, code: otp, new_password: password })
                        });
                        const verifyData = await verifyResponse.json();
                        if (!verifyResponse.ok) throw new Error(verifyData.message || 'OTP verification failed');

                        // Step 3: Redirect to group page based on signup_type
                        toastr.success('Signup verified! Redirecting to your page...');
                        const redirectPath = signupType === 'seller' ? '/merchant' : '/community';
                        setTimeout(() => window.location.href = redirectPath, 2000);
                    });
                }
            } catch (error) {
                toastr.error(error.message || 'Error during signup/OTP process');
            }
        });

        // Toastr options
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: 'toast-top-right',
            timeOut: 5000
        };
    </script>
</body>
</html>
siterequest.inc
<form id="siteRequestForm" class="settings-form">
    <input type="hidden" id="userType" value="{{ user_type }}">

    <label for="name">{{ 'Community Name' if user_type == 'community' else 'Store Name' }}:</label>
    <input type="text" id="name" name="name" placeholder="Enter your {{ 'community' if user_type == 'community' else 'store' }} name" required>

    <label for="about">{{ 'About Our Community' if user_type == 'community' else 'About Your Store' }}:</label>
    <textarea id="about" name="about" placeholder="Tell us about your {{ 'community' if user_type == 'community' else 'store' }}"></textarea>

    <label for="logos">{{ 'Community Logos' if user_type == 'community' else 'Store Logos' }}:</label>
    <input type="file" id="logos" name="logos" accept="image/*" multiple>
    <small>Upload up to 5 logos (e.g., main logo, secondary logos).</small>

    <label for="colorPrefs">Color Preferences:</label>
    <input type="text" id="colorPrefs" name="colorPrefs" placeholder="e.g., #FF5733, Blue">

    <label for="stylingDetails">Styling Details:</label>
    <textarea id="stylingDetails" name="stylingDetails" rows="4" placeholder="e.g., modern layout, bold fonts"></textarea>

    <label for="preferredDomain">Preferred Domain Name:</label>
    <input type="text" id="preferredDomain" name="preferredDomain" placeholder="e.g., my{{ 'community.org' if user_type == 'community' else 'store.uk' }}" oninput="updateEmailDomains()">
    <button type="button" data-action="checkDomainAvailability"><i class="fas fa-search"></i> Check Availability</button>

    <label>Email Addresses to Set Up (up to 5):</label>
    <div id="emailsContainer">
        <div class="email-section" data-email="1">
            <label for="email1Name">Email Name:</label>
            <input type="text" id="email1Name" name="email1Name" placeholder="e.g., info">
            <span id="email1Domain">@my{{ 'community.org' if user_type == 'community' else 'store.uk' }}</span>
        </div>
    </div>
    <button type="button" data-action="addEmail"><i class="fas fa-plus"></i> Add Another Email</button>

    <label>{{ 'Requested Pages (up to 5)' if user_type == 'community' else 'Required Pages' }}:</label>
    <div id="pagesContainer">
        {% if user_type == 'merchant' %}
            <!-- Fixed Home page -->
            <div class="page-section" data-page="1">
                <label for="page1Name">Page Name:</label>
                <input type="text" id="page1Name" name="page1Name" value="Home" readonly>
                <br><br>
                <label for="page1Content">Home Page Content:</label>
                <textarea id="page1Content" name="page1Content" placeholder="Describe your home page (e.g., welcome message, featured products)"></textarea>
                <label for="page1Images">Additional Images:</label>
                <input type="file" id="page1Images" name="page1Images" accept="image/*" multiple>
            </div>
            <!-- Fixed Returns Policy page -->
            <div class="page-section" data-page="2">
                <label for="page2Name">Page Name:</label>
                <input type="text" id="page2Name" name="page2Name" value="Returns Policy" readonly>
                <br><br>
                <label for="page2Content">Returns Policy Content:</label>
                <textarea id="page2Content" name="page2Content" placeholder="Outline your returns policy"></textarea>
                <label for="page2Images">Additional Images:</label>
                <input type="file" id="page2Images" name="page2Images" accept="image/*" multiple>
            </div>
        {% else %}
            <!-- Community starts with one customizable page -->
            <div class="page-section" data-page="1">
                <label for="page1Name">Page Name:</label>
                <input type="text" id="page1Name" name="page1Name" value="Home">
                <br><br>
                <label for="page1Content">Page Content:</label>
                <textarea id="page1Content" name="page1Content" placeholder="Describe this page"></textarea>
                <label for="page1Images">Additional Images:</label>
                <input type="file" id="page1Images" name="page1Images" accept="image/*" multiple>
            </div>
        {% endif %}
    </div>
    <button type="button" data-action="addPage"><i class="fas fa-plus"></i> Add Another Page</button>

    <label>{{ 'Wix Widgets' if user_type == 'community' else 'Wix Store Widgets' }}:</label>
    <div class="widget-checkboxes">
        {% if user_type == 'community' %}
            <div><label><input type="checkbox" name="widgets" value="events"> Events</label> - Add an events calendar.</div>
            <div><label><input type="checkbox" name="widgets" value="socialMediaFeeds"> Social Media Feeds</label> - Display live social media feeds.</div>
            <div><label><input type="checkbox" name="widgets" value="gallery"> Gallery</label> - Showcase photos.</div>
            <div><label><input type="checkbox" name="widgets" value="contactForm"> Contact Form</label> - Simple contact form.</div>
            <div><label><input type="checkbox" name="widgets" value="blog"> Blog</label> - Share updates and stories.</div>
            <div><label><input type="checkbox" name="widgets" value="weather"> Weather</label> - Show real-time weather.</div>
            <div><label><input type="checkbox" name="widgets" value="socialMediaLinks"> Social Media Links</label> - Quick links to profiles.</div>
        {% else %}
            <div><label><input type="checkbox" name="widgets" value="productCatalog"> Product Catalog</label> - Display your products.</div>
            <div><label><input type="checkbox" name="widgets" value="checkout"> Checkout</label> - Enable direct purchases.</div>
            <div><label><input type="checkbox" name="widgets" value="cart"> Shopping Cart</label> - Add a cart for customers.</div>
            <div><label><input type="checkbox" name="widgets" value="promotions"> Promotions</label> - Highlight sales and discounts.</div>
            <div><label><input type="checkbox" name="widgets" value="contactForm"> Contact Form</label> - Customer inquiries.</div>
        {% endif %}
    </div>

    <button type="button" data-action="saveSiteRequest"><i class="fas fa-paper-plane"></i> Submit Request</button>
</form>
welcome.inc
<!-- templates/welcome.inc -->

{% if page_type == 'admin' %}
    <h2>Admin Info</h2>
    <p id="welcome-message">Hello, <span id="user-contact-name">[User]</span>! This dashboard is your central hub for overseeing the clubmadeira.io platform.</p>
    <p>Use the menu to manage affiliate programs, deal listings, user permissions, and test scripts. This powerful toolset allows you to maintain and optimize the platform for all users.</p>
{% elif page_type == 'merchant' %}
    <h2>Merchant Info</h2>
    <p id="welcome-message">Hello, <span id="user-contact-name">[User]</span>! This dashboard is designed for merchants to manage integrations with clubmadeira.io.</p>
    <p>Use the menu to manage products, your store, Wix integration, and account settings. Grow your business by leveraging our tools to showcase deals and track performance.</p>
{% elif page_type == 'community' %}
    <h2>Community Info</h2>
    <p id="welcome-message">Hello, <span id="user-contact-name">[User]</span>! This dashboard connects your community with valuable resources on clubmadeira.io.</p>
    <p>Use the menu to integrate discounts into your website, select product categories, track referrals, and update account details. Build stronger ties by sharing benefits with your members.</p>
{% elif page_type == 'partner' %}
    <h2>Partner Info</h2>
    <p id="welcome-message">Hello, <span id="user-contact-name">[User]</span>! This dashboard empowers partners to collaborate with merchants and communities on clubmadeira.io.</p>
    <p>Use the menu to manage integrations, review site requests, access documentation, and update your account. Work together to create tailored solutions for our users.</p>
{% else %}
    <h2>Login</h2>
    <div class="custom-login-notice">
        <span class="highlight">Please log in</span> to access your account. If you donât have an account, click "Sign Up" below.
    </div>
{% endif %}

